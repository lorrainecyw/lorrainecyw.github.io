(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{782:function(a,e,t){"use strict";t.r(e);var v=t(11),_=Object(v.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"覆盖索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#覆盖索引"}},[a._v("#")]),a._v(" 覆盖索引")]),a._v(" "),t("p",[a._v("概念：索引覆盖了我们的“查询需求”，不需要再回表了\n例子：id 为主键，字段 k 上有索引，"),t("code",[a._v("select id from T where k = 5")]),a._v("\n在上面那个例子中，只需要在 k 的索引树上定位到 k = 5 的位置，取到 id 就可以了，不需要再到主键的索引树去取数据，这样减少了回表的次数，显著提高了查询的性能，所以使用覆盖索引是有效的数据库性能优化手段")]),a._v(" "),t("h2",{attrs:{id:"前缀索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前缀索引"}},[a._v("#")]),a._v(" 前缀索引")]),a._v(" "),t("h3",{attrs:{id:"最左前缀原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最左前缀原则"}},[a._v("#")]),a._v(" 最左前缀原则")]),a._v(" "),t("p",[a._v("概念：以左边为起点，任何连续的索引都能够匹配上\n例如联合索引"),t("code",[a._v("(a, b, c)")]),a._v("，会先按照 a 排序，再按 b 排序，最后按 c 排序")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("select * from T where a = 5 and b = 10")]),a._v("，对于这个语句，"),t("strong",[a._v("可以")]),a._v(" 用上索引"),t("code",[a._v("(a, b, c)")])]),a._v(" "),t("li",[t("code",[a._v("select * from T where b = 10 and c = 15")]),a._v("，对于这个语句，"),t("strong",[a._v("无法")]),a._v(" 用上索引"),t("code",[a._v("(a, b, c)")])])]),a._v(" "),t("h3",{attrs:{id:"注意点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意点"}},[a._v("#")]),a._v(" 注意点")]),a._v(" "),t("ol",[t("li",[a._v("只要满足最左前缀，那么都可以通过索引来加快检索速度。这个最左前缀可以是联合索引最左边的 N 个字段，也可以是字符串索引最左 M 个字符。")]),a._v(" "),t("li",[a._v("由于索引维护需要成本，所以能少建一个索引，就少建一个，所以索引建立时需要根据最左前缀原则，合理安排索引字段的顺序，根据业务需求来安排顺序")])]),a._v(" "),t("h3",{attrs:{id:"思考题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#思考题"}},[a._v("#")]),a._v(" 思考题")]),a._v(" "),t("h4",{attrs:{id:"例子1-有联合索引-a-b-如果既有联合查询-又有基于-a、b-各自的查询-该如何做"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例子1-有联合索引-a-b-如果既有联合查询-又有基于-a、b-各自的查询-该如何做"}},[a._v("#")]),a._v(" 例子1：有联合索引"),t("code",[a._v("(a, b)")]),a._v("，如果既有联合查询，又有基于 a、b 各自的查询，该如何做 ？")]),a._v(" "),t("p",[a._v("联合查询可以用索引"),t("code",[a._v("(a, b)")]),a._v("，基于 a 的查询同样可以用"),t("code",[a._v("(a, b)")]),a._v("，但是基于 b 的查询就不能用了，需要建立索引 b，来加快基于 b 的查询速度")]),a._v(" "),t("h4",{attrs:{id:"例子2-表-t-用字段-a-、b-做联合主键-字段-c-上有索引-需要做基于-c-的查询-还有基于-c、a-的查询和基于-c、b-的查询-该如何做"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例子2-表-t-用字段-a-、b-做联合主键-字段-c-上有索引-需要做基于-c-的查询-还有基于-c、a-的查询和基于-c、b-的查询-该如何做"}},[a._v("#")]),a._v(" 例子2：表 T 用字段 a 、b 做联合主键，字段 c 上有索引，需要做基于 c 的查询，还有基于 c、a 的查询和基于 c、b 的查询，该如何做？")]),a._v(" "),t("p",[a._v("主键索引 a，b 的聚簇索引组织顺序相当于"),t("code",[a._v("order by a,b")]),a._v("，相当于先按 a 排序，再按 b 排序\n而索引 c 会按照 c 排序，然后记录主键的值，相当于先按 c 排序，再按 a 排序，最后按 b 排序，那么索引 c 就能够加快基于 c 的查询以及基于 c、a 的查询了；对于基于 c、b 的查询，可以创建一个联合索引"),t("code",[a._v("(c, b)")])]),a._v(" "),t("h2",{attrs:{id:"索引下推"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引下推"}},[a._v("#")]),a._v(" 索引下推")]),a._v(" "),t("p",[a._v("在"),t("code",[a._v("MySQL 5.6")]),a._v("之后才引入的索引下推优化\n索引下推：在索引遍历的过程中，对索引中包含的字段先做判断，直接过滤掉不符合条件的记录，然后再回表，这样能够有效减少回表的次数")]),a._v(" "),t("h3",{attrs:{id:"图解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#图解"}},[a._v("#")]),a._v(" 图解")]),a._v(" "),t("blockquote",[t("p",[a._v("对于 user 表，有字段 id、name、age 等字段，id 为主键，有联合索引"),t("code",[a._v("(name, age)")]),a._v("\n查询语句："),t("code",[a._v("select * from user where name like '张%' and age = 10")])])]),a._v(" "),t("p",[a._v("对于这个语句，在搜索索引树的时候只能通过“张”找到第一个符合条件的记录，id = 2 的记录")]),a._v(" "),t("h4",{attrs:{id:"无索引下推的执行流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#无索引下推的执行流程"}},[a._v("#")]),a._v(" 无索引下推的执行流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lorrainecyw/PhotoStorage@main/blogImage/1658331614735-2f388a25-0863-4f30-99e1-c6a129fe9acd.jpeg",alt:""}}),a._v("\n从上图可得，需要回表 4 次，虽然索引有记录 age 的值，但是 InnoDB 并不会去看，而是会选择先回表，再看 age 的值是否符合条件\n语句执行的流程分为以下几步：")]),a._v(" "),t("ol",[t("li",[a._v("通过联合索引定位到第一个 name 以“张”开头的记录，将记录取出，得到主键值")]),a._v(" "),t("li",[a._v("回表，到主键索引树获取整行记录")]),a._v(" "),t("li",[a._v("判断这行记录的 age 是否符合条件，符合则加入结果集")])]),a._v(" "),t("h4",{attrs:{id:"有索引下推的执行流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#有索引下推的执行流程"}},[a._v("#")]),a._v(" 有索引下推的执行流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lorrainecyw/PhotoStorage@main/blogImage/1658331616758-37dd440e-ea89-40f9-b86a-308a824fdcac.jpeg",alt:""}}),a._v("\n从上图可得，只需要回表 2 次\n语句执行的流程分为以下几步：")]),a._v(" "),t("ol",[t("li",[a._v("通过联合索引定位到第一个 name 以“张”开头的记录")]),a._v(" "),t("li",[a._v("直接判断该记录的 age 是否符合条件，符合才回表，不符合直接查看下一条记录")])])])}),[],!1,null,null,null);e.default=_.exports}}]);